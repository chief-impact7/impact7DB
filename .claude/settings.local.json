{
  "permissions": {
    "allow": [
      "Bash(npm init -y && npm install firebase && npm install -D vite)",
      "Bash(npm pkg set scripts.dev=\"vite\" scripts.build=\"vite build\" scripts.preview=\"vite preview\" && npm pkg set type=\"module\")",
      "Bash(npx vite --version)",
      "Bash(git add app.js auth.js userlog.js firebase-config.js index.html package.json .firebaserc firebase.json firestore.rules firestore.indexes.json)",
      "Bash(git commit -m \"$\\(cat <<'EOF'\nWire up Firebase backend: Auth, Firestore, and audit logging\n\n- Add firebase-config.js: initializes Firebase app, exports auth and db\n- Implement userlog.js: mandatory audit middleware writing to history_logs\n  with google_login_id + timestamp on every save \\(Rules.md §2\\)\n- Rewrite app.js: onAuthStateChanged, loadStudentList from Firestore,\n  selectStudent loads daily_flow, saveDailyFlow writes daily_flow + history_logs\n- Update auth.js: import from firebase-config, restrict login to gw.impact7.kr\n- Update index.html: type=\"module\" on script tag, IDs on time inputs\n- Add package.json with firebase + vite \\(run with: npm run dev\\)\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(npm run dev)",
      "Bash(xdg-open http://localhost:5174/ 2>/dev/null || explorer.exe http://localhost:5174/ 2>/dev/null || cmd.exe /c start http://localhost:5174/)",
      "Bash(powershell.exe -Command \"Start-Process 'http://localhost:5174/'\")",
      "Bash(npm install firebase-admin --save-dev)",
      "Bash(node import-students.js)",
      "Bash(node check-duplicates.js)",
      "Bash(node dedup-students.js)",
      "Bash(node --input-type=module << 'EOF'\nimport { initializeApp } from 'firebase/app';\nimport { getFirestore, collection, getDocs } from 'firebase/firestore';\n\nconst firebaseConfig = {\n    apiKey:            \"AIzaSyCb2DKuKVjYevqDlmeL3qa07jSE5azm8Nw\",\n    authDomain:        \"impact7db.firebaseapp.com\",\n    projectId:         \"impact7db\",\n    storageBucket:     \"impact7db.firebasestorage.app\",\n    messagingSenderId: \"485669859162\",\n    appId:             \"1:485669859162:web:2cfe866520c0b8f3f74d63\"\n};\n\nconst app = initializeApp\\(firebaseConfig\\);\nconst db = getFirestore\\(app\\);\n\nconst snapshot = await getDocs\\(collection\\(db, 'students'\\)\\);\nconst docs = snapshot.docs.map\\(d => \\({ docId: d.id, ...d.data\\(\\) }\\)\\);\n\nconst noId = docs.filter\\(d => !d.student_id\\);\nconsole.log\\(`\\\\nstudent_id 없는 문서: ${noId.length}개`\\);\nnoId.forEach\\(d => {\n    console.log\\(`  docId: ${d.docId} | name: ${d.name} | school: ${d.school} | branch: ${d.branch}`\\);\n}\\);\n\nconst correct = docs.filter\\(d => d.student_id && d.docId === d.student_id\\);\nconsole.log\\(`\\\\n정상 문서 \\(docId=student_id\\): ${correct.length}개`\\);\nprocess.exit\\(0\\);\nEOF)",
      "Bash(node --input-type=module << 'EOF'\nimport { initializeApp } from 'firebase/app';\nimport { getFirestore, collection, getDocs } from 'firebase/firestore';\nimport { readFileSync } from 'fs';\n\nconst firebaseConfig = {\n    apiKey:            \"AIzaSyCb2DKuKVjYevqDlmeL3qa07jSE5azm8Nw\",\n    authDomain:        \"impact7db.firebaseapp.com\",\n    projectId:         \"impact7db\",\n    storageBucket:     \"impact7db.firebasestorage.app\",\n    messagingSenderId: \"485669859162\",\n    appId:             \"1:485669859162:web:2cfe866520c0b8f3f74d63\"\n};\n\nconst app = initializeApp\\(firebaseConfig\\);\nconst db = getFirestore\\(app\\);\n\n// Firestore에 있는 student_id 목록\nconst snapshot = await getDocs\\(collection\\(db, 'students'\\)\\);\nconst inFirestore = new Set\\(snapshot.docs.map\\(d => d.id\\)\\);\n\n// CSV 파싱\nconst csv = readFileSync\\('students.csv', 'utf8'\\).split\\('\\\\n'\\);\nconst headers = csv[0].split\\(','\\);\nconst idIdx   = headers.indexOf\\('ID'\\);\nconst nameIdx = headers.indexOf\\('이름'\\);\n\nconst missing = [];\nfor \\(let i = 1; i < csv.length; i++\\) {\n    const cols = csv[i].split\\(','\\);\n    if \\(!cols[idIdx]\\) continue;\n    const id = cols[idIdx].trim\\(\\);\n    const name = \\(cols[nameIdx] || ''\\).trim\\(\\);\n    if \\(!inFirestore.has\\(id\\)\\) {\n        missing.push\\({ id, name }\\);\n    }\n}\n\nconsole.log\\(`\\\\nCSV에 있지만 Firestore에 없는 학생: ${missing.length}명`\\);\nmissing.forEach\\(s => console.log\\(`  ID: ${s.id} | 이름: ${s.name}`\\)\\);\nprocess.exit\\(0\\);\nEOF)",
      "Bash(node --input-type=module << 'EOF'\nimport { readFileSync } from 'fs';\nconst lines = readFileSync\\('students.csv', 'utf8'\\).split\\('\\\\n'\\);\nconst headers = lines[0].split\\(','\\);\n// rows 290, 291 \\(1-indexed, so index 290, 291 in lines array\\)\n[290, 291].forEach\\(i => {\n    const vals = lines[i].split\\(','\\);\n    const obj = {};\n    headers.forEach\\(\\(h, j\\) => obj[h.trim\\(\\)] = \\(vals[j]||''\\).trim\\(\\)\\);\n    console.log\\(`행 ${i+1}:`, JSON.stringify\\(obj, null, 2\\)\\);\n}\\);\nEOF)",
      "Bash(node --input-type=module << 'EOF'\nimport { readFileSync } from 'fs';\nconst lines = readFileSync\\('students.csv', 'utf8'\\).split\\('\\\\n'\\);\nconst headers = lines[0].split\\(','\\);\n// 임승찬 is at rows 290 and 291 \\(row = i+1, so i=289 and i=290\\)\n[289, 290].forEach\\(i => {\n    const vals = lines[i].split\\(','\\);\n    const obj = {};\n    headers.forEach\\(\\(h, j\\) => obj[h.trim\\(\\)] = \\(vals[j]||''\\).trim\\(\\)\\);\n    console.log\\(`행 ${i+1}:`, JSON.stringify\\(obj\\)\\);\n}\\);\nEOF)",
      "Bash(which firebase 2>/dev/null || npx firebase --version 2>/dev/null | head -1)",
      "Bash(firebase deploy --only firestore 2>&1)",
      "Bash(firebase --version && cat .firebaserc 2>/dev/null)",
      "Bash(firebase deploy --only firestore --debug 2>&1 | head -30)",
      "Bash(firebase login --list 2>&1)"
    ]
  }
}
