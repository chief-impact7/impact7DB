# 학기별 자동 반이동 디자인

## 문제

새 학기 반편성 데이터를 업로드하면 이전 학기 enrollment이 그대로 활성 상태로 남아, 학생이 2개 반을 동시에 다니는 것처럼 보임. 실제로는 반의 "이동"이지 "추가"가 아님.

## 핵심 원칙

- DB는 건드리지 않는다 — 모든 enrollment 이력은 영구 보존
- 프론트엔드에서 오늘 날짜 기준으로 활성/비활성을 판단
- 재원기간은 가장 이른 start_date 기준 (기존 로직 유지)
- 과거 이력은 항상 조회 가능

## 활성 enrollment 판단 로직

학생의 enrollment 목록에서, 같은 **class_type**(정규/특강/내신) 기준으로:

1. start_date <= 오늘인 것 중 **가장 최근 start_date**가 활성
2. start_date > 오늘이면 "예정" (미래 반편성, 아직 비활성)
3. 같은 class_type의 새 enrollment이 없으면 이전 학기 것이 계속 활성

### 예시 (오늘 = 2026-03-05)

| enrollment | class_type | start_date | semester | 상태 |
|-----------|-----------|-----------|---------|------|
| 정규 A101 화,목 | 정규 | 2025-01-01 | 2026winter | 비활성 (더 새로운 정규 있음) |
| 정규 AX103 화,목 | 정규 | 2026-03-02 | 2026-Spring | 활성 |
| 특강 201 목 | 특강 | 2025-01-01 | 2026winter | 활성 (봄학기 특강 없으므로 유지) |

### 예시 (오늘 = 2026-02-28, 아직 봄학기 전)

| enrollment | class_type | start_date | semester | 상태 |
|-----------|-----------|-----------|---------|------|
| 정규 A101 화,목 | 정규 | 2025-01-01 | 2026winter | 활성 (아직 최신) |
| 정규 AX103 화,목 | 정규 | 2026-03-02 | 2026-Spring | 예정 (start_date > 오늘) |
| 특강 201 목 | 특강 | 2025-01-01 | 2026winter | 활성 |

## 영향 범위

| 화면 | 변경 내용 |
|------|----------|
| 학생 목록 (필터 없음) | 활성 enrollment 기준으로만 반/요일/레벨 표시 |
| 학기 필터 선택 시 | 기존대로 해당 학기 enrollment만 표시 (변경 없음) |
| 학생 상세 — 수업 정보 | 활성 enrollment만 기본 표시. 비활성(이전 학기) 이력도 별도 표시 |
| 학생 상세 — 재원기간 | 변경 없음 (가장 이른 start_date 기준) |
| 학생 상세 — 레벨 이력 | 변경 없음 (모든 enrollment 표시) |
| 통계/그룹뷰 | 활성 enrollment 기준으로 집계 |
| upsert (데이터 업로드) | 변경 없음 — 새 학기 enrollment을 추가만 하면 됨 |

## 상세화면 이력 표시

```
[수업 정보]
✅ 정규  AX103  화,목  (2026-Spring, 3월 2일~)
✅ 특강  201    목     (2026winter, 1월 1일~)  ← 봄학기 특강 없으므로 유지

[이전 학기 이력]
  정규  A101  화,목  (2026winter, 1월 1일 ~ 3월 1일)  ← 비활성, 반이동됨
```

## 구현 방향

app.js에 `getActiveEnrollments(student)` 유틸리티 함수를 추가하여, 학생 목록 렌더링/통계/그룹뷰에서 활성 enrollment만 사용하도록 변경. 학기 필터가 적용된 경우는 기존 로직 유지.
